<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Arch Linux bulletproof no config color emoji</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/css/normalize.css">
  <link rel="stylesheet" href="/css/github.css">
  <link rel="stylesheet" href="/css/main-20211017.css">
  <link rel="icon" href="/favicon.ico" data-emoji="üèï">
  <link rel="alternate" href="/feed.xml" type="application/atom+xml" title="CodeJam">
  <meta property="og:title" content="Arch Linux bulletproof no config color emoji">
  <meta property="og:description" content="I (used to) use DejaVu (ttf-dejavu) as my main system and default font on Arch Linux and I‚Äôve been mildly bothered about some emoji not being displayed as color emoji even though I have noto-fonts-emoji installed, and instead being displayed as black and white glyphs.">
  <meta property="og:image" content="https://www.codejam.info/img/profile.jpg">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@valeriangalliat">
  <meta name="twitter:creator" content="@valeriangalliat">
</head>
<body class="post">
  <nav>
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/val.html">About</a></li>
      <li><a href="https://photography.codejam.info/">Photography</a></li>
    </ul>
    <ul class="social">
      <li>
        <a href="https://www.youtube.com/FunkyVal">
          <svg width="16" height="16" viewBox="0 0 16 16">
            <title>YouTube</title>
            <use href="/img/icons/414-youtube.svg#icon"></use>
          </svg>
        </a>
      </li>
      <li>
        <a href="https://www.instagram.com/funkyval_/">
          <svg width="16" height="16" viewBox="0 0 16 16">
            <title>Instagram</title>
            <use href="/img/icons/403-instagram.svg#icon"></use>
          </svg>
        </a>
      </li>
      <li>
        <a href="https://twitter.com/valeriangalliat">
          <svg width="16" height="16" viewBox="0 0 16 16">
            <title>Twitter</title>
            <use href="/img/icons/407-twitter.svg#icon"></use>
          </svg>
        </a>
      </li>
      <li>
        <a href="https://github.com/valeriangalliat">
          <svg width="16" height="16" viewBox="0 0 16 16">
            <title>GitHub</title>
            <use href="/img/icons/433-github.svg#icon"></use>
          </svg>
        </a>
      </li>
      <li>
        <a href="https://ko-fi.com/funkyval">
          <svg width="16" height="16" viewBox="0 0 16 16">
            <title>Buy me a coffee!</title>
            <use href="/img/icons/219-heart.svg#icon"></use>
          </svg>
        </a>
      </li>
      <li>
        <a href="/feed.xml">
          <svg width="16" height="16" viewBox="0 0 16 16">
            <title>RSS</title>
            <use href="/img/icons/412-rss.svg#icon"></use>
          </svg>
        </a>
      </li>
    </ul>
  </nav>
  <header>
    <div class="header-inner">
      <div class="content">
<h1>Arch Linux bulletproof no config color emoji</h1>
<p class="date">May 27, 2020</p>
      </div>
    </div>
  </header>
  <div class="content">
<p>I (used to) use DejaVu (<code>ttf-dejavu</code>) as my main system and default font
on Arch Linux and I‚Äôve been mildly bothered about some emoji not being
displayed as color emoji even though I have <code>noto-fonts-emoji</code>
installed, and instead being displayed as black and white glyphs.</p>
<p>For a while, I‚Äôve haven‚Äôt been bothered enough by it to actually dig
into it, but recently I‚Äôve decided to spend the time to figure it out.</p>
<h2 id="tldr" tabindex="-1"><a class="header-anchor" href="#tldr"><span>TLDR</span></a></h2>
<p>If you use <code>ttf-dejavu</code>, remove it and install <code>ttf-bitstream-vera</code> instead,
which is essentially the same font without the Unicode additions. Then
if you want some proper Unicode support, make sure to have <code>noto-fonts</code>
installed as well, so that it will fall back to Noto Unicode characters
when they‚Äôre not defined by Vera.</p>
<p>Alternatively, just remove DejaVu and make Noto your default font,
period (which is even simpler and is what I‚Äôve done in the end since I
ended up liking the look of the Noto fonts even better).</p>
<h2 id="why-this-bug-happens" tabindex="-1"><a class="header-anchor" href="#why-this-bug-happens"><span>Why this bug happens</span></a></h2>
<p>The black and white glyphs are from the <code>ttf-dejavu</code> font, which is
essentially <code>tff-bitstream-vera</code> with added Unicode support, but that
also includes <em>some</em> black and white emoji.</p>
<p>This means that if you have an emoji font as fallback, e.g.
<code>noto-fonts-emoji</code>, <code>ttf-dejavu</code> will still have priority over the
subset of emoji that it defines.</p>
<p>Since it‚Äôs not currently possible to blacklist part of a font characters
in fontconfig, there‚Äôs been some forks of <code>ttf-dejavu</code> to remove emoji
characters, but still keep the other Unicode additions. This seems like
a good idea but the AUR package for that is fairly outdated and people
seem to report issues with it, so I would rather not go that way.</p>
<p>I‚Äôve also found <a href="https://www.reddit.com/r/archlinux/comments/6wkval/enable_noto_color_emoji_easily/">on Reddit</a>
a fontconfig, well, config, to fix that issue, which essentially sets
the default font to Noto instead of DejaVu, and Noto natively don‚Äôt try
to conflict with the emoji font, so that works.</p>
<p>However, some websites depending on the font they request, and depending
on your browser, and configuration, and a bunch of other shit, are still
gonna be using DejaVu if it‚Äôs installed, and then you‚Äôll get the black
and white emoji back, since that config only makes Noto and its color
emoji the default for generic fonts.</p>
<p>At that point you can just remove DejaVu altogether, which is the
solution I ended up going for, but if you want to keep the DejaVu/Vera
font as your default system font, read on.</p>
<h2 id="the-solution" tabindex="-1"><a class="header-anchor" href="#the-solution"><span>The solution</span></a></h2>
<p>I‚Äôve spent some more time digging, and I‚Äôve eventually found a setup
that so far seems to work consistently across browsers and websites, and
the good thing is that it‚Äôs <em>simple</em> and doesn‚Äôt require any manual
configuration.</p>
<p>Simply remove <code>ttf-dejavu</code> and install <code>ttf-bitstream-vera</code> instead,
which is essentially the same font, without the addition of Unicode
glyphs, and then make sure to have <code>noto-fonts</code> installed as a fallback
for Unicode stuff.</p>
<p>Since unlike DejaVu, Noto doesn‚Äôt try to define its own emoji, it‚Äôll
cleanly fall through, first, Vera, then for the Unicode characters not
found in Vera, it‚Äôll fall back to Noto, and finally it‚Äôll use whatever
emoji font you have installed!</p>
<p>I hope that helps!</p>
<section class="post-footer">
  <h3>Want to leave a comment?</h3>
  <p>
    Start a conversation on <a href="https://twitter.com/valeriangalliat">Twitter</a> or send me an <a href="mailto:val@codejam.info">email</a>! üíå<br>
    This post helped you? <a href="https://ko-fi.com/funkyval">Buy me a coffee</a>! üçª
  </p>
</section>
  </div>
  <footer>
    <p>
      Made with üß° by <a href="/val.html">Val</a> in Montreal.<br>
      Generated from a <a href="https://github.com/valeriangalliat/blog/tree/master/2020/05/arch-linux-bulletproof-no-config-color-emoji.md">public repository</a>. Feel free to <a href="/val.html#contact">contact me</a>, I'd love to hear your thoughts!
    </p>
  </footer>
  <script src="/js/emojicon.js"></script>
  <script src="/js/main-20210719.js"></script>
</body>
</html>

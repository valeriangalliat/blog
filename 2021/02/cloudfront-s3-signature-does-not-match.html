<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CloudFront and S3: SignatureDoesNotMatch, the request signature we calculated does not match the signature you provided</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/css/normalize.css">
  <link rel="stylesheet" href="/css/github.css">
  <link rel="stylesheet" href="/css/main-20220617.css">
  <link rel="icon" href="/favicon.ico" data-emoji="üèïÔ∏è">
  <link rel="alternate" href="/feed.xml" type="application/atom+xml" title="CodeJam">
  <meta property="og:title" content="CloudFront and S3: SignatureDoesNotMatch, the request signature we calculated does not match the signature you provided">
  <meta property="og:description" content="Maybe you‚Äôre getting the following error from your CloudFront distribution like it happened to me.">
  <meta property="og:image" content="https://www.codejam.info/img/profile.jpg">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@valeriangalliat">
  <meta name="twitter:creator" content="@valeriangalliat">
</head>
<body class="post">
  <nav>
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/val.html">About</a></li>
    </ul>
  </nav>
  <header>
    <div class="header-inner">
      <div class="content">
<h1>CloudFront and S3: <code>SignatureDoesNotMatch</code>, the request signature we calculated does not match the signature you provided</h1>
<p class="date">February 26, 2021</p>
      </div>
    </div>
  </header>
  <div class="content">
<p>Maybe you‚Äôre getting the following error from your CloudFront
distribution like it happened to me.</p>
<pre><code class="hljs language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Error</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Code</span>&gt;</span>SignatureDoesNotMatch<span class="hljs-tag">&lt;/<span class="hljs-name">Code</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Message</span>&gt;</span>The request signature we calculated does not match the signature you provided. Check your key and signing method.<span class="hljs-tag">&lt;/<span class="hljs-name">Message</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Error</span>&gt;</span>
</code></pre>
<p>If so, maybe like me you configured the <code>Managed-AllViewer</code> origin
request policy, which forwards all the headers, cookies and query string
parameters to the origin.</p>
<p>The issue is, if your origin is S3, something between CloudFront and S3
doesn‚Äôt expect all the headers, cookies and query string parameters to
be passed and they don‚Äôt compute the signature in the same way,
resulting in the above error.</p>
<p>This means you can‚Äôt use the <code>Managed-AllViewer</code> request policy if your
origin is S3.</p>
<p>If like me you need to access extra headers or query string parameters
from a Lambda@Edge (which you won‚Äôt be able to unless your request
policy sends those), you can try making a custom request policy to
whitelist only the headers and query parameters that you need. This did
the trick for me!</p>
<section class="post-footer">
  <h3>Want to leave a comment?</h3>
  <p>
    Start a conversation on <a href="https://twitter.com/valeriangalliat">Twitter</a> or send me an <a href="mailto:val@codejam.info">email</a>! üíå<br>
    This post helped you? <a href="https://ko-fi.com/funkyval">Buy me a coffee</a>! üçª
  </p>
</section>
  </div>
  <footer>
    <figure>
      <a href="/val.html">
        <img alt="The author (Val) looking at a beer glass shining in the beautiful sun" src="/img/profile.jpg">
      </a>
    </figure>
    <div class="footer-content">
      <p>
        Made with üß° by <a href="/val.html">Val</a>.
        Generated from a <abbr title="Pull requests welcome!"><a href="https://github.com/valeriangalliat/blog/tree/master/2021/02/cloudfront-s3-signature-does-not-match.md">public repository</a></abbr>.
      </p>
      <ul class="social">
        <li>
          <a href="https://twitter.com/valeriangalliat">
            <svg width="16" height="16" viewBox="0 0 16 16">
              <title>Twitter</title>
              <use href="/img/icons/407-twitter.svg#icon"></use>
            </svg>
          </a>
        </li>
        <li>
          <a href="https://github.com/valeriangalliat">
            <svg width="16" height="16" viewBox="0 0 16 16">
              <title>GitHub</title>
              <use href="/img/icons/433-github.svg#icon"></use>
            </svg>
          </a>
        </li>
        <li>
          <a href="https://www.instagram.com/funkyval_/">
            <svg width="16" height="16" viewBox="0 0 16 16">
              <title>Instagram</title>
              <use href="/img/icons/403-instagram.svg#icon"></use>
            </svg>
          </a>
        </li>
        <li>
          <a href="https://www.youtube.com/FunkyVal">
            <svg width="16" height="16" viewBox="0 0 16 16">
              <title>YouTube</title>
              <use href="/img/icons/414-youtube.svg#icon"></use>
            </svg>
          </a>
        </li>
        <li>
          <a href="https://ko-fi.com/funkyval">
            <svg width="16" height="16" viewBox="0 0 16 16">
              <title>Buy me a coffee!</title>
              <use href="/img/icons/219-heart.svg#icon"></use>
            </svg>
          </a>
        </li>
        <li>
          <a href="/feed.xml">
            <svg width="16" height="16" viewBox="0 0 16 16">
              <title>RSS</title>
              <use href="/img/icons/412-rss.svg#icon"></use>
            </svg>
          </a>
        </li>
      </ul>
    </div>
  </footer>
  <script src="/js/emojicon.js"></script>
  <script src="/js/main-20210719.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>The disk wasn‚Äôt ejected because one or more programs may be using it</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script>document.documentElement.classList.add(localStorage.theme || ((matchMedia && matchMedia('(prefers-color-scheme: dark)').matches) ? 'dark' : 'light'))</script>
  <link rel="stylesheet" href="/css/normalize.css">
  <link rel="stylesheet" href="/css/github-20220617.css">
  <link rel="stylesheet" href="/css/main-20250606.css">
  <link rel="icon" href="/favicon.ico" data-emoji="üèïÔ∏è">
  <link rel="alternate" href="/feed.xml" type="application/atom+xml" title="CodeJam">
  <meta property="og:title" content="The disk wasn‚Äôt ejected because one or more programs may be using it">
  <meta property="og:description" content="To eject the disk immediately, click the force eject button. If you run macOS, you might have run in the following error message when trying to eject a removable device:">
  <meta property="og:image" content="https://www.codejam.info/img/profile.jpg">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@valeriangalliat">
  <meta name="twitter:creator" content="@valeriangalliat">
</head>
<body class="post">
  <nav>
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/val.html">About</a></li>
      <li><a href="/now.html">Now</a></li>
      <li class="pull"><button title="Toggle theme" class="change-color-theme">üåù</button></li>
    </ul>
  </nav>
  <header>
    <div class="header-inner">
      <div class="content">
<h1>The disk wasn‚Äôt ejected because one or more programs may be using it</h1>
<p class="tagline">To eject the disk immediately, click the force eject button</p>
<p class="date">May 5, 2022</p>
      </div>
    </div>
  </header>
  <div class="content">
<p>If you run macOS, you might have run in the following error message when
trying to eject a removable device:</p>
<figure class="center">
  <img alt="The disk wasn‚Äôt ejected because one or more programs may be using it" src="../../img/2022/05/macos-disk-eject.png">
</figure>
<p>In some cases, even waiting a few minutes doesn‚Äôt solve the problem.
Often, it happens after deleting files from the device just before
ejecting, and Quick Look is often the culprit. Let‚Äôs see.</p>
<p><em>Inspired by <a href="https://mycyberuniverse.com/macos/how-fix-volume-cant-be-ejected-because-currently-use-user.html">this post</a>
and <a href="https://mycyberuniverse.com/macos/how-fix-volume-cant-be-ejected-because-currently-use.html">this post</a>.</em></p>
<h2 id="investigating" tabindex="-1"><a class="header-anchor" href="#investigating"><span>Investigating</span></a></h2>
<p>To know what program is currently using the volume you‚Äôre trying to
eject, you can use the <a href="https://linux.die.net/man/8/lsof"><code>lsof(8)</code></a>
command. In my case the volume is <code>/Volumes/LUMIX</code>:</p>
<pre><code class="hljs language-console"> lsof +c0 /Volumes/LUMIX
COMMAND            PID USER   FD   TYPE DEVICE   SIZE/OFF   NODE NAME
QuickLookUIService 611  val    3r   REG   1,31 2970637594     51 /Volumes/LUMIX/.Trashes/501/P2770021.MP4
</code></pre>
<div class="note">
<p><strong>Note:</strong> the <code>+c0</code> option here is to display the full command string.
By default, it only shows 9 characters.</p>
</div>
<p>You can see that <code>QuickLookUIService</code> is still doing something with the
file <code>P2770021.MP4</code> that I deleted‚Ä¶ and it‚Äôs probably stuck and
confused because the file is not there anymore.</p>
<h2 id="killing" tabindex="-1"><a class="header-anchor" href="#killing"><span>Killing</span></a></h2>
<p>To fix that, we can kill the <code>QuickLookUIService</code> process (or whatever
process was blocking in your case).</p>
<div class="note">
<p><strong>Note:</strong> in the case of <code>QuickLookUIService</code>, it‚Äôs safe to kill, but if
you‚Äôre dealing with a different program preventing you to eject your
drive, it‚Äôs up to your own judgment whether it‚Äôs a good idea or not to
kill it!</p>
</div>
<p>There‚Äôs essentially two methods we‚Äôll talk about: soft kill, which would
be<code>pkill QuickLookUIService</code> and hard kill, with <code>pkill -9 QuickLookUIService</code>.</p>
<p>In the case of this bug, it looks like we need to resort to hard kill,
as a soft kill doesn‚Äôt terminate the hanging process:</p>
<pre><code class="hljs language-sh">pkill -9 QuickLookUIService
</code></pre>
<p>Now you should be able to eject your device!</p>
<h2 id="restarting-quick-look" tabindex="-1"><a class="header-anchor" href="#restarting-quick-look"><span>Restarting Quick Look</span></a></h2>
<p>Quick Look is the macOS service responsible for computing file previews
for various UI components. After we killed it, it might or might not
restart by itself, so if you notice that new file previews and
thumbnails don‚Äôt appear anymore in your Finder, you can restart Quick
Look with the following command:</p>
<pre><code class="hljs language-sh">qlmanage -r
</code></pre>
<p>It won‚Äôt hurt to run it either way after killing the process and
ejecting the drive.</p>
<section class="post-footer">
  <h3>Want to leave a comment?</h3>
  <p>
    Start a conversation on <a href="https://twitter.com/valeriangalliat">Twitter</a> or send me an <a href="mailto:val@codejam.info">email</a>! üíå<br>
    This post helped you? <a href="https://ko-fi.com/funkyval">Buy me a coffee</a>! üçª
  </p>
</section>
  </div>
  <footer>
    <div class="footer-inner">
      <figure>
        <a href="/val.html">
          <img alt="The author (Val) in front of a mountain" src="/img/profile.jpg">
        </a>
      </figure>
      <div class="footer-content">
        <p>
          Made with üß° by <a href="/val.html">Val</a>.
          Generated from a <abbr title="Pull requests welcome!"><a href="https://github.com/valeriangalliat/blog/tree/master/2022/05/macos-disk-not-ejected-programs-using-it.md">public repository</a></abbr>.
        </p>
        <ul class="social">
          <li>
            <a href="https://twitter.com/valeriangalliat">
              <svg width="16" height="16" viewBox="0 0 16 16">
                <title>Twitter</title>
                <use href="/img/icons/407-twitter.svg#icon"></use>
              </svg>
            </a>
          </li>
          <li>
            <a href="https://github.com/valeriangalliat">
              <svg width="16" height="16" viewBox="0 0 16 16">
                <title>GitHub</title>
                <use href="/img/icons/433-github.svg#icon"></use>
              </svg>
            </a>
          </li>
          <li>
            <a href="https://www.instagram.com/funkyval_/">
              <svg width="16" height="16" viewBox="0 0 16 16">
                <title>Instagram</title>
                <use href="/img/icons/403-instagram.svg#icon"></use>
              </svg>
            </a>
          </li>
          <li>
            <a href="https://www.youtube.com/@FunkyVal">
              <svg width="16" height="16" viewBox="0 0 16 16">
                <title>YouTube</title>
                <use href="/img/icons/414-youtube.svg#icon"></use>
              </svg>
            </a>
          </li>
          <li>
            <a href="https://ko-fi.com/funkyval">
              <svg width="16" height="16" viewBox="0 0 16 16">
                <title>Buy me a coffee!</title>
                <use href="/img/icons/219-heart.svg#icon"></use>
              </svg>
            </a>
          </li>
          <li>
            <a href="/feed.xml">
              <svg width="16" height="16" viewBox="0 0 16 16">
                <title>RSS</title>
                <use href="/img/icons/412-rss.svg#icon"></use>
              </svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </footer>
  <script src="/js/emojicon.js"></script>
  <script src="/js/main-20230317.js"></script>
</body>
</html>

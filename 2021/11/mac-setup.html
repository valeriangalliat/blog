<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>How I set up a new Mac</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script>document.documentElement.classList.add(localStorage.theme || ((matchMedia && matchMedia('(prefers-color-scheme: dark)').matches) ? 'dark' : 'light'))</script>
  <link rel="stylesheet" href="/css/normalize.css">
  <link rel="stylesheet" href="/css/github-20220617.css">
  <link rel="stylesheet" href="/css/main-20260125.css">
  <link rel="icon" href="/favicon.ico" data-emoji="üèïÔ∏è">
  <link rel="alternate" href="/feed.xml" type="application/atom+xml" title="CodeJam">
  <meta property="og:title" content="How I set up a new Mac">
  <meta property="og:description" content="Note: updated March 17, 2023 with Ventura!">
  <meta property="og:image" content="https://www.codejam.info/img/profile.jpg">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@valeriangalliat">
  <meta name="twitter:creator" content="@valeriangalliat">
</head>
<body class="post">
  <nav>
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/val.html">About</a></li>
      <li><a href="/now.html">Now</a></li>
      <li class="pull"><button title="Toggle theme" class="change-color-theme">üåù</button></li>
    </ul>
  </nav>
  <header>
    <div class="header-inner">
      <div class="content">
<h1>How I set up a new Mac</h1>
<p class="date">November 17, 2021</p>
      </div>
    </div>
  </header>
  <div class="content">
<div class="note">
<p><strong>Note:</strong> updated March 17, 2023 with Ventura!</p>
</div>
<p>As I <a href="yearly-hackintosh-upgrade-macos-monterey-with-opencore.html">recently blogged</a>,
I just upgraded to macOS Monterey taking it as an opportunity to start
from a clean, fresh, pristine system. This means I had to set up
everything again, which is not a big deal, but for the sake of
remembering it and making it even faster next time, I figured I‚Äôd write
about it.</p>
<p>This is the kind of blog post that‚Äôs <em>mostly</em> for my personal interest,
but if you got there somehow, you might take inspiration from my
settings, who knows!</p>
<p>But first, let‚Äôs ask the following question.</p>
<h2 id="why-start-fresh" tabindex="-1"><a class="header-anchor" href="#why-start-fresh"><span>Why start fresh?</span></a></h2>
<p>While I could totally have migrated all my data from Big Sur, I like
to start from a clean slate every year or two, to get rid of all the
unnecessary garbage that accumulated over the years.</p>
<p>Wait, what garbage? Well, let me explain.</p>
<p>Every time you update a software (including the OS), there‚Äôs no
guarantee that the state you‚Äôll be in after the update would be the
same as if you installed the new version directly on a fresh system.
Actually, the opposite is pretty much guaranteed.</p>
<p>Most of the time this is not a big deal. Maybe you‚Äôre stuck with the
default settings of the version you originally installed instead of
the ones that would otherwise come with the latest version (i.e. Git
always defaults to <code>master</code> and you have to explicitly configure it to
use <code>main</code>, or any small things like this).</p>
<p>Or maybe some commands or tasks might run slightly slower because of
accumulated ‚Äúbloat‚Äù related to things you don‚Äôt use anymore and forgot
about (keys, passwords, certificates, trusted IP lists and whatnot
from stuff you connected to once or at least stopped connecting to
ages ago, the list of known Wi-Fi networks and <code>~/.ssh/known_hosts</code>
being a typical example).</p>
<p>While the above are pretty inoffensive cases, this kind of undefined
state drifts might cause more sneaky bugs, and ‚Äúworks on that machine‚Äù
kind of answers when you try to figure them out.</p>
<p>The same is also true when you uninstall a software; there‚Äôs no
guarantee that the state you‚Äôll be in after the removal will match the
one you would have been in if you didn‚Äôt install it in the first place.
And again, the opposite is pretty much guaranteed.</p>
<p><a href="https://nixos.org/">NixOS</a> solves some of those issues, but in the real
world, you‚Äôre likely gonna want to use many programs that are not
designed and packaged to be stateless, deterministic, reproducible and
purely functional, and using wrappers (or wrapping them yourself) often
comes at a tremendous cost in time and convenience.</p>
<p>My tradeoff so far? A fresh reinstall every other year, or whenever I
feel like I‚Äôve fucked around enough with that system‚Äôs state to be worth
a clean start.</p>
<h2 id="new-system-setup" tabindex="-1"><a class="header-anchor" href="#new-system-setup"><span>New system setup</span></a></h2>
<p>Here‚Äôs the things I do when I log in the first time on my freshly
installed system.</p>
<ul>
<li>
<p>Get rid of all the garbage in the dock. I just leave the Finder and
the trash, because you can‚Äôt really remove them anyways (did you try
dragging the trash to the trash?), but I happen to use them so that‚Äôs
fine.</p>
</li>
<li>
<p>Open the terminal app to install <a href="https://brew.sh/">Homebrew</a> with
whatever is the current recommended way. I Install it in the default
place because otherwise it won‚Äôt be able to leverage many prebuilt
binaries that hardcode the default prefix in them, and it‚Äôs utterly
slow to compile everything. If you want to run Homebrew on a
multi-user system, <a href="homebrew-multi-user.html">read that first</a>.</p>
<p>After the installation, Homebrew tells you add <code>eval &quot;$(/opt/homebrew/bin/brew shellenv)&quot;</code> to your <code>~/.zprofile</code>. I
personally prefer to use my <code>~/.zshenv</code> for this, because it‚Äôs sourced
all the time whereas <code>.zprofile</code> is sourced only for login shells.
Concretely this means that by setting the Homebrew environment
variables in <code>.zshenv</code>, I can do <code>ssh me@my-machine brew ...</code>, whereas with <code>.zprofile</code>, I can‚Äôt.</p>
<p>Also I don‚Äôt like running <code>eval &quot;$(brew shellenv)&quot;</code> on every single
Zsh boot, I‚Äôd rather hardcode the output of <code>brew shellenv</code> in there
since it‚Äôs not really supposed to change anyway. Concretely, I run:</p>
<pre><code class="hljs language-sh">/opt/homebrew/bin/brew shellenv &gt;&gt; ~/.zshenv
</code></pre>
</li>
<li>
<p>Install Firefox and iTerm2 and optionally other apps:</p>
<pre><code class="hljs language-sh">brew install firefox iterm2
<span class="hljs-comment"># brew install rectangle</span>
<span class="hljs-comment"># brew install homebrew/cask-versions/firefox-developer-edition</span>
<span class="hljs-comment"># brew install google-chrome</span>
<span class="hljs-comment"># brew install visual-studio-code</span>
</code></pre>
</li>
<li>
<p>Install <strong>DaVinci Resolve</strong>.</p>
</li>
<li>
<p>Install <strong>Logic Pro</strong> an download the full sound library. Sadly a fresh
Logic installation can‚Äôt reuse an existing sound library directory (I
like to keep mine on my hard drive instead of my limited size SSD), so
we need to download the whole 60 GB from scratch.</p>
</li>
<li>
<p>Press <kbd>Command</kbd> + <kbd>Shift</kbd> + <kbd>5</kbd> to open the
custom screenshot interface, where I can change the <strong>screenshot
directory</strong> to <code>~/Desktop/Screenshots</code>. I don‚Äôt like to clutter my
desktop with screenshots like it‚Äôs the case by default.</p>
</li>
</ul>
<p>Now I‚Äôm ready to configure the <a href="#system-preferences">system preferences</a>,
<a href="#iterm2-preferences">iTerm2 preferences</a> and my <a href="#terminal-environment">terminal-environment</a>.</p>
<h2 id="system-preferences" tabindex="-1"><a class="header-anchor" href="#system-preferences"><span>System preferences</span></a></h2>
<ul>
<li>In <strong>Keyboard</strong> I set <strong>Key repeat rate</strong> and <strong>Delay until repeat</strong>
to the fastest possible. I like my keyboard to be snappy.</li>
<li>In <strong>Keyboard &gt; Input Sources</strong>, I <strong>Edit</strong> the settings to disable
everything. Also in the <strong>Text Replacements</strong> part, I remove the
built-in <code>omw</code> abbreviation. See <a href="../../img/2021/11/keyboard-before.png">before</a>
and <a href="../../img/2021/11/keyboard-after.png">after</a>. I‚Äôm always
staggered when I forget to do this and <code>omw</code> gets replaced by <code>On my way!</code>, or when I press space twice and it inserts a colon instead
<em>while I code in Visual Studio Code</em>! ü§¶‚Äç‚ôÄÔ∏è</li>
<li>In <strong>Keyboard &gt; Keyboard Shortcuts &gt; Mission Control</strong>, I
enable the <strong>Switch to Desktop</strong> shortcuts for <a href="../../2022/05/macos-faster-desktops-dock.html">faster desktop switching</a>.</li>
<li>In <strong>Control Center</strong>, I leave only <strong>Time Machine</strong> and <strong>Fast
User Switching</strong> in the menu bar if I‚Äôm on a multi-user system, and I
set the <strong>Clock</strong> to 24 hours format.</li>
<li>In <strong>Desktop &amp; Dock</strong>, tick <strong>Automatically hide and show the Dock</strong>,
untick <strong>Show recent applications in Dock</strong>, and under <strong>Mission
Control</strong>, untick <strong>Automatically rearrange Spaces based on most recent use</strong>.</li>
<li>I enable <strong>Time Machine</strong> backups to my usual drive after configuring
my exclude list (very specific to my data so not included here).</li>
<li>In <strong>Displays</strong> I turn on <strong>Night Shift</strong> form sunset to sunrise.</li>
<li>Run <code>defaults write com.apple.dock autohide-delay -float 0; killall Dock</code>
to <a href="../../2022/05/macos-faster-desktops-dock.html">remove the delay</a> to
show and hide the dock.</li>
<li>In <strong>General &gt; Software Update &gt; Automatic updates</strong>, I turn on
<strong>Check for updates</strong> and <strong>Download new updates when available</strong>, but
make sure <strong>Install macOS updates</strong> is off (I don‚Äôt want macOS to
reboot without my permission and lose any unsaved state).</li>
<li>If I installed Visual Studio Code, I run <code>defaults write com.microsoft.VSCode ApplePressAndHoldEnabled -bool false</code>
for‚Ä¶ sanity. For Cursor it‚Äôs <code>defaults write com.todesktop.230313mzl4w4u92 ApplePressAndHoldEnabled -bool false</code>,
and for Antigravity it‚Äôs <code>defaults write com.google.antigravity ApplePressAndHoldEnabled -bool false</code>.</li>
</ul>
<h2 id="iterm2-preferences" tabindex="-1"><a class="header-anchor" href="#iterm2-preferences"><span>iTerm2 preferences</span></a></h2>
<pre><code class="hljs language-sh"><span class="hljs-comment"># Appearance &gt; General &gt; Theme: Minimal</span>
defaults write com.googlecode.iterm2 TabStyleWithAutomaticOption -int 5

<span class="hljs-comment"># Appearance &gt; Windows: Hide scrollbars</span>
defaults write com.googlecode.iterm2 HideScrollbar -bool <span class="hljs-literal">true</span>

<span class="hljs-comment"># Appearance &gt; Tabs: Preserve window size when tab bar shows or hides</span>
defaults write com.googlecode.iterm2 PreserveWindowSizeWhenTabBarVisibilityChanges -bool <span class="hljs-literal">true</span>

<span class="hljs-comment"># Appearance &gt; Panes &gt; Show per-pane title bars: off</span>
defaults write com.googlecode.iterm2 ShowPaneTitles -bool <span class="hljs-literal">false</span>

<span class="hljs-comment"># Appearance &gt; Dimming &gt; Dimming amount: 10</span>
defaults write com.googlecode.iterm2 SplitPaneDimmingAmount -<span class="hljs-built_in">float</span> 0.1

<span class="hljs-comment"># Advanced &gt; Mouse: Scroll wheel sends arrow keys when in alternate screen mode</span>
defaults write com.googlecode.iterm2 AlternateMouseScroll -bool <span class="hljs-literal">true</span>

<span class="hljs-comment"># Profiles &gt; General &gt; Initial directory: Reuse previous session&#x27;s directory</span>
/usr/libexec/PlistBuddy -c <span class="hljs-string">&quot;Set &#x27;:New Bookmarks:0:Custom Directory&#x27; Recycle&quot;</span> ~/Library/Preferences/com.googlecode.iterm2.plist

<span class="hljs-comment"># Profiles &gt; Terminal &gt; Bell: Silence bell</span>
/usr/libexec/PlistBuddy -c <span class="hljs-string">&quot;Set &#x27;:New Bookmarks:0:Silence Bell&#x27; true&quot;</span> ~/Library/Preferences/com.googlecode.iterm2.plist
</code></pre>
<div class="note">
<p><strong>Note:</strong> run this when iTerm2 is <em>not</em> running.</p>
</div>
<p>Finally (I couldn‚Äôt script this), in <strong>Profiles &gt; Keys &gt; Key Bindings</strong>,
load the <strong>Natural Text Editing</strong> preset (allow it to remove whatever is
already there), and remove <kbd>Command</kbd> + <kbd>Left</kbd> and
<kbd>Command</kbd> + <kbd>Right</kbd> which otherwise shadow the
shortcuts to navigate between tabs.</p>
<h2 id="terminal-environment" tabindex="-1"><a class="header-anchor" href="#terminal-environment"><span>Terminal environment</span></a></h2>
<p>First, I make a SSH keypair or copy an existing one in <code>~/.ssh</code>. I
usually run <code>ssh-keygen</code> either way just to let it create the directory
with the proper permissions, even if I‚Äôll override the key later.</p>
<pre><code class="hljs language-sh">ssh-keygen -t ed25519
</code></pre>
<p>Clone my <a href="https://github.com/valeriangalliat/dotfiles">dotfiles</a>
directory and install my Mac preset (mainly my Zsh, Vim and Git
settings).</p>
<pre><code class="hljs language-sh">git <span class="hljs-built_in">clone</span> git@github.com:valeriangalliat/dotfiles.git
<span class="hljs-built_in">cd</span> dotfiles
make mac
<span class="hljs-built_in">cd</span>
</code></pre>
<p>Edit my default <code>~/.zshrc</code> and <code>~/.zshenv</code> templates and comment or
uncomment some of the stuff there that I may need, mainly enabling my
asdf helper (see below).</p>
<pre><code class="hljs language-sh">vim ~/.zshrc ~/.zshenv
</code></pre>
<p>Install whatever software I pretty much always use with Homebrew.</p>
<pre><code class="hljs language-sh">brew install rg fzf imagemagick ffmpeg ncdu htop
</code></pre>
<ul>
<li><a href="https://github.com/BurntSushi/ripgrep">ripgrep</a>
is my favorite way to search code.</li>
<li><a href="https://github.com/junegunn/fzf">fzf</a> is an awesome fuzzy finder.</li>
<li>I probably don‚Äôt need to introduce <a href="https://imagemagick.org/">ImageMagick</a>
and <a href="https://www.ffmpeg.org/">FFmpeg</a>.</li>
<li><a href="https://dev.yorhel.nl/ncdu">ncdu</a> is a cool tool to monitor disk usage.</li>
<li><a href="https://htop.dev/">htop</a> is an awesome process viewer.</li>
</ul>
<p>Install the <a href="https://github.com/asdf-vm/asdf">asdf</a> plugins I need
and whatever version is in my <code>~/.tool-versions</code>. My <code>~/.zshrc</code>
automatically installs asdf on the first invocation so no need to do
that manually.</p>
<pre><code class="hljs language-sh">asdf plugin add nodejs
<span class="hljs-comment"># asdf plugin add python</span>
<span class="hljs-comment"># asdf plugin add ruby</span>
<span class="hljs-comment"># asdf plugin add elixir</span>
<span class="hljs-comment"># asdf plugin add erlang</span>
asdf install
</code></pre>
<h2 id="wrapping-up" tabindex="-1"><a class="header-anchor" href="#wrapping-up"><span>Wrapping up</span></a></h2>
<p>That‚Äôs pretty much the gist! This is a fairly straightforward and not
very time consuming checklist, and the main things that need to be
automated (my dotfiles) are.</p>
<p>I don‚Äôt think it‚Äôs worth automating my macOS system preferences somehow
as they might change in future versions anyways. Same thing for iTerm2,
where I definitely don‚Äôt want to copy over my whole configuration file
from an old installation, I‚Äôd rather start from the latest and greatest
defaults and just tweak what I need on top of it.</p>
<p>Everything else is very specific to the current machine I‚Äôm setting up
and I leave them to my discretion at the time of installing.</p>
<p>If you read until there, I hope that you learnt something, or that it
inspired you to document your base setup in a similar way. Cheers!</p>
<section class="post-footer">
  <h3>Want to leave a comment?</h3>
  <p>
    Join the discussion on <a href="https://x.com/valeriangalliat/status/1461136814400577537">X</a> or send me an <a href="mailto:val@codejam.info">email</a>! üíå<br>
    This post helped you? <a href="https://ko-fi.com/funkyval">Buy me a coffee</a>! üçª
  </p>
</section>
  </div>
  <footer>
    <div class="footer-inner">
      <figure>
        <a href="/val.html">
          <img alt="The author (Val) in front of a mountain" src="/img/profile.jpg">
        </a>
      </figure>
      <div class="footer-content">
        <p>
          Made with üß° by <a href="/val.html">Val</a>.
          Generated from a <abbr title="Pull requests welcome!"><a href="https://github.com/valeriangalliat/blog/tree/master/2021/11/mac-setup.md">public repository</a></abbr>.
        </p>
        <ul class="social">
          <li>
            <a href="https://x.com/valeriangalliat">
              <svg width="16" height="16" viewBox="0 0 24 24">
                <title>X</title>
                <use href="/img/icons/x.svg#icon"></use>
              </svg>
            </a>
          </li>
          <li>
            <a href="https://github.com/valeriangalliat">
              <svg width="16" height="16" viewBox="0 0 24 24">
                <title>GitHub</title>
                <use href="/img/icons/github.svg#icon"></use>
              </svg>
            </a>
          </li>
          <li>
            <a href="https://www.instagram.com/funkyval_/">
              <svg width="16" height="16" viewBox="0 0 24 24">
                <title>Instagram</title>
                <use href="/img/icons/instagram.svg#icon"></use>
              </svg>
            </a>
          </li>
          <li>
            <a href="https://www.youtube.com/@FunkyVal">
              <svg width="16" height="16" viewBox="0 0 24 24">
                <title>YouTube</title>
                <use href="/img/icons/youtube.svg#icon"></use>
              </svg>
            </a>
          </li>
          <li>
            <a href="https://ko-fi.com/funkyval">
              <svg width="16" height="16" viewBox="0 0 24 24">
                <title>Buy me a coffee!</title>
                <use href="/img/icons/kofi.svg#icon"></use>
              </svg>
            </a>
          </li>
          <li>
            <a href="/feed.xml">
              <svg width="16" height="16" viewBox="0 0 24 24">
                <title>RSS</title>
                <use href="/img/icons/rss.svg#icon"></use>
              </svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </footer>
  <script src="/js/emojicon.js"></script>
  <script src="/js/main-20230317.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Installing Gogs on FreeBSD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/css/normalize.css">
  <link rel="stylesheet" href="/css/github.css">
  <link rel="stylesheet" href="/css/main-20210924.css">
  <link rel="icon" href="data:," data-emoji="🏕">
  <link rel="alternate" href="/feed.xml" type="application/atom+xml" title="CodeJam">
  <meta property="og:title" content="Installing Gogs on FreeBSD">
  <meta property="og:description" content="Gogs is a self-hosted Git service, not unlike GitHub, but lightweight and open source. Here’s a small tutorial to install it in its own jail on a FreeBSD host.">
  <meta property="og:image" content="https://www.codejam.info/img/profile.jpg">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@valeriangalliat">
  <meta name="twitter:creator" content="@valeriangalliat">
</head>
<body class="post">
  <nav>
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/val.html">About</a></li>
      <li><a href="/resources/freelance.html">Freelance</a></li>
      <li><a href="https://photography.codejam.info/">Photography</a></li>
    </ul>
    <ul class="social">
      <li>
        <a href="https://www.youtube.com/FunkyVal">
          <svg width="16" height="16" viewBox="0 0 16 16">
            <title>YouTube</title>
            <use href="/img/icons/414-youtube.svg#icon"></use>
          </svg>
        </a>
      </li>
      <li>
        <a href="https://www.instagram.com/funkyval_/">
          <svg width="16" height="16" viewBox="0 0 16 16">
            <title>Instagram</title>
            <use href="/img/icons/403-instagram.svg#icon"></use>
          </svg>
        </a>
      </li>
      <li>
        <a href="https://twitter.com/valeriangalliat">
          <svg width="16" height="16" viewBox="0 0 16 16">
            <title>Twitter</title>
            <use href="/img/icons/407-twitter.svg#icon"></use>
          </svg>
        </a>
      </li>
      <li>
        <a href="https://github.com/valeriangalliat">
          <svg width="16" height="16" viewBox="0 0 16 16">
            <title>GitHub</title>
            <use href="/img/icons/433-github.svg#icon"></use>
          </svg>
        </a>
      </li>
      <li>
        <a href="https://www.linkedin.com/in/valeriangalliat/">
          <svg width="16" height="16" viewBox="0 0 16 16">
            <title>LinkedIn</title>
            <use href="/img/icons/458-linkedin.svg#icon"></use>
          </svg>
        </a>
      </li>
      <li>
        <a href="/feed.xml">
          <svg width="16" height="16" viewBox="0 0 16 16">
            <title>RSS</title>
            <use href="/img/icons/412-rss.svg#icon"></use>
          </svg>
        </a>
      </li>
    </ul>
  </nav>
  <header>
    <div class="header-inner">
      <div class="content">
<h1>Installing Gogs on FreeBSD</h1>
<p class="date">March 7, 2015</p>
      </div>
    </div>
  </header>
  <div class="content">
<p><a href="http://gogs.io/">Gogs</a> is a self-hosted Git service, not unlike GitHub, but lightweight
and open source. Here’s a small tutorial to install it in its own jail
on a FreeBSD host.</p>
<h2 id="preparation" tabindex="-1"><a class="header-anchor" href="#preparation">Preparation</a></h2>
<p>First, create the jail, start it, and open a shell into it. You can
skip this step if you don’t want to install it into a jail. Assuming
you use <a href="http://erdgeist.org/arts/software/ezjail/">ezjail</a>:</p>
<pre><code class="hljs language-sh">ezjail-admin create gogs <span class="hljs-variable">$ip</span>
ezjail-admin start gogs
ezjail-admin console gogs
</code></pre>
<p>Where <code>$ip</code> is the jail IP address.</p>
<p>Then install the required packages:</p>
<pre><code class="hljs language-sh">pkg install go git gcc
</code></pre>
<p>Add the <code>git</code> user and open a shell with it:</p>
<pre><code class="hljs language-sh">pw useradd git -m
su - git
</code></pre>
<p>And setup the Go environment (locally and permanently):</p>
<pre><code class="hljs language-sh">GOPATH=<span class="hljs-variable">$HOME</span>/go; <span class="hljs-built_in">export</span> GOPATH
<span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;GOPATH=$HOME/go; export GOPATH&#x27;</span> &gt;&gt; ~/.profile
</code></pre>
<h2 id="installation" tabindex="-1"><a class="header-anchor" href="#installation">Installation</a></h2>
<p>We can now install Gogs using the Go package manager:</p>
<pre><code class="hljs language-sh">CC=gcc48 go get -u --tags sqlite github.com/gogits/gogs
</code></pre>
<p><code>CC=gcc48</code> is required to force the build tool to use GCC instead of
Clang (default on FreeBSD) for the compilation, because it appears some
sources fail to be compiled with Clang.</p>
<p>The <code>-u</code> flag tells the Go package manager to use the network to fetch
the package and its dependencies.</p>
<p>Here, I choose to use Gogs with SQLite backend, by using <code>--tags sqlite</code>.</p>
<p>I made a symlink to the Gogs directory so I can easily access it:</p>
<pre><code class="hljs language-sh">ln -s go/src/github.com/gogits/gogs gogs
</code></pre>
<p>Then build Gogs itself (the previous command only fetched it):</p>
<pre><code class="hljs language-sh"><span class="hljs-built_in">cd</span> gogs
CC=gcc48 go build --tags sqlite
</code></pre>
<h2 id="configuration" tabindex="-1"><a class="header-anchor" href="#configuration">Configuration</a></h2>
<p>The default configuration can be extended by creating
<code>custom/conf/app.ini</code>.</p>
<pre><code class="hljs language-sh">mkdir -p custom/conf
vim custom/conf/app.ini
</code></pre>
<p>We need to at least configure the database, and since we’re on FreeBSD
and Bash is not installed by default, we must also tell Gogs to use <code>sh</code>
instead (needed for Git hooks), see <code>SCRIPT_TYPE</code> option. Here’s my
whole configuration:</p>
<pre><code class="hljs language-ini"><span class="hljs-attr">RUN_USER</span> = git
<span class="hljs-attr">RUN_MODE</span> = prod

<span class="hljs-section">[database]</span>
<span class="hljs-attr">DB_TYPE</span> = sqlite3
<span class="hljs-attr">PATH</span> = data/gogs.db

<span class="hljs-section">[repository]</span>
<span class="hljs-attr">ROOT</span> = /home/git/gogs-repositories
<span class="hljs-attr">SCRIPT_TYPE</span> = sh

<span class="hljs-section">[server]</span>
<span class="hljs-attr">DOMAIN</span> = git.codejam.info
<span class="hljs-attr">ROOT_URL</span> = https://git.codejam.info/
<span class="hljs-attr">HTTP_PORT</span> = <span class="hljs-number">3000</span>
<span class="hljs-attr">DISABLE_SSH</span> = <span class="hljs-literal">true</span>
<span class="hljs-attr">LANDING_PAGE</span> = explore

<span class="hljs-section">[session]</span>
<span class="hljs-attr">PROVIDER</span> = file

<span class="hljs-section">[log]</span>
<span class="hljs-attr">MODE</span> = file

<span class="hljs-section">[security]</span>
<span class="hljs-attr">INSTALL_LOCK</span> = <span class="hljs-literal">true</span>
<span class="hljs-attr">SECRET_KEY</span> = ThisIsNotMySecretKey

<span class="hljs-section">[service]</span>
<span class="hljs-attr">DISABLE_REGISTRATION</span> = <span class="hljs-literal">true</span>
</code></pre>
<p>See the <a href="http://gogs.io/docs/advanced/configuration_cheat_sheet.html">other configuration options</a> and tweak to your tastes!</p>
<h2 id="execution" tabindex="-1"><a class="header-anchor" href="#execution">Execution</a></h2>
<p>Run the server with:</p>
<pre><code class="hljs language-sh">./gogs web
</code></pre>
<p>Ideally you’ll write an init script for this, but I’m lazy and I just
put it in a <code>@reboot</code> entry in the crontab:</p>
<pre><code class="hljs language-sh">PATH=/bin:/usr/bin:/usr/<span class="hljs-built_in">local</span>/bin
@reboot <span class="hljs-built_in">cd</span> ~/gogs &amp;&amp; ./gogs web &gt; logs/main.log
</code></pre>
<h2 id="updating" tabindex="-1"><a class="header-anchor" href="#updating">Updating</a></h2>
<p>To update Gogs to the latest version, basically replay the installation
process:</p>
<pre><code class="hljs language-sh">CC=gcc48 go get -u --tags sqlite github.com/gogits/gogs
<span class="hljs-built_in">cd</span> ~/gogs
CC=gcc48 go build --tags sqlite
</code></pre>
  </div>
  <footer>
    <p>
      Made with 🧡 by <a href="/val.html">Val</a> in Montreal.<br>
      Generated from a <a href="https://github.com/valeriangalliat/blog/tree/master/2015/03/installing-gogs-on-freebsd.md">public repository</a>. Feel free to <a href="/val.html#contact">contact me</a>, I'd love to hear your thoughts!
    </p>
  </footer>
  <script src="/js/emojicon.js"></script>
  <script src="/js/main-20210719.js"></script>
</body>
</html>

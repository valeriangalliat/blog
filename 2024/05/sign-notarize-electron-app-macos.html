<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>How to sign and notarize an Electron app for macOS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script>document.documentElement.classList.add(localStorage.theme || ((matchMedia && matchMedia('(prefers-color-scheme: dark)').matches) ? 'dark' : 'light'))</script>
  <link rel="stylesheet" href="/css/normalize.css">
  <link rel="stylesheet" href="/css/github-20220617.css">
  <link rel="stylesheet" href="/css/main-20260124.css">
  <link rel="icon" href="/favicon.ico" data-emoji="üèïÔ∏è">
  <link rel="alternate" href="/feed.xml" type="application/atom+xml" title="CodeJam">
  <meta property="og:title" content="How to sign and notarize an Electron app for macOS">
  <meta property="og:description" content="So you made a macOS app, shared it with your friends, and they encountered one of those dreaded popups:">
  <meta property="og:image" content="https://www.codejam.info/img/profile.jpg">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@valeriangalliat">
  <meta name="twitter:creator" content="@valeriangalliat">
</head>
<body class="post">
  <nav>
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/val.html">About</a></li>
      <li><a href="/now.html">Now</a></li>
      <li class="pull"><button title="Toggle theme" class="change-color-theme">üåù</button></li>
    </ul>
  </nav>
  <header>
    <div class="header-inner">
      <div class="content">
<h1>How to sign and notarize an Electron app for macOS</h1>
<p class="date">May 15, 2024</p>
      </div>
    </div>
  </header>
  <div class="content">
<p>So you made a macOS app, shared it with your friends, and they
encountered one of those dreaded popups:</p>
<figure class="grid">
  <img alt="App cannot be opened because it is from an unidentified developer" srcset="../../img/2024/05/electron-signature/unidentified-developer.png 2x">
  <img alt="App can‚Äôt be opened because Apple cannot check it for malicious software" srcset="../../img/2024/05/electron-signature/cannot-check.png 2x">
</figure>
<p>Then you need to sign (left) and notarize (right) your app!</p>
<div class="note">
<p><strong>Note:</strong> in the meantime, the app
<a href="https://support.apple.com/en-ca/guide/mac-help/mh40616/mac">can still</a>
<a href="https://support.apple.com/en-ca/guide/mac-help/mchleab3a043/mac">be opened</a>
by right clicking on it and clicking <strong>Open</strong> from the context menu.</p>
</div>
<p>Signing consists in buying a developer membership with Apple, which will
let you create a key that you can use to <code>codesign</code> your app with.</p>
<p>Notarizing consists in uploading your app to an Apple service that scans
it for malware. If it passes the process, your app gets a ‚Äústamp of
approval‚Äù that is <a href="https://developer.apple.com/documentation/security/notarizing_macos_software_before_distribution">bundled with your app and also mirrored</a>
on Apple‚Äôs Gatekeeper servers.</p>
<p>In the case of Electron, here‚Äôs some relevant docs this article is based
on:</p>
<ul>
<li><a href="https://www.electronjs.org/docs/latest/tutorial/code-signing#signing--notarizing-macos-builds">Electron: Signing &amp; notarizing macOS builds</a></li>
<li><a href="https://www.electronforge.io/guides/code-signing/code-signing-macos">Electron Forge: Signing a macOS app</a></li>
</ul>
<h2 id="get-a-signing-certificate" tabindex="-1"><a class="header-anchor" href="#get-a-signing-certificate"><span>Get a signing certificate</span></a></h2>
<p>The first step is to generate a signing keypair, and get a signing
certificate from Apple, which requires you to subscribe to
<a href="https://developer.apple.com/">Apple‚Äôs developer program</a>.</p>
<p>Then, follow <a href="https://developer.apple.com/help/account/create-certificates/create-a-certificate-signing-request">create a certificate signing request</a>.</p>
<p>In my experience, it doesn‚Äôt seem that the <strong>User Email Address</strong> you
input matters.</p>
<p>As for <strong>Common Name</strong>, it seems to only affect how the private and
public key are named in Keychain Access.</p>
<p>By saving the request to disk, you will get a
<code>CertificateSigningRequest.certSigningRequest</code> file.</p>
<p>This will also create a <code>Common Name.p12</code> and <code>Common Name.pem</code> entry in
your Keychain Access. The <code>.p12</code> is the private key, and the <code>.pem</code> is
the public key, that are going to be associated with the certificate
you‚Äôre requesting.</p>
<p>You should now upload the <code>.certSigningRequest</code> file to your Apple
Developer account, in <strong>Certificates, IDs &amp; Profiles</strong>. Choose the
<strong>Developer ID Application</strong> certificate type.</p>
<p>This will give you a certificate <code>developerID_application.cer</code> that you
need to import in Keychain Access (by simply opening it).</p>
<div class="note">
<p><strong>Note:</strong> if it refuses to open with ‚ÄúThe System Roots keychain cannot
be modified‚Äù, it‚Äôs because Keychain Access opens by default in the
System Roots keychain and you can only update it as superuser (so mainly
from the CLI with <code>sudo security ...</code>).</p>
<p>We only need this certificate in the login keychain, so make sure it‚Äôs
the selected one in Keychain Access and then open the certificate again.</p>
</div>
<h2 id="get-the-intermediate-certificate" tabindex="-1"><a class="header-anchor" href="#get-the-intermediate-certificate"><span>Get the intermediate certificate</span></a></h2>
<p>In Apple‚Äôs <abbr title="Public key infrastructure"><a href="https://www.apple.com/certificateauthority/">PKI</a></abbr>,
your developer certificate is signed by an intermediate certificate,
that‚Äôs itself signed by one of Apple‚Äôs root certificates.</p>
<p>The Apple root certificates should already be present out of the box in
your System Roots keychain, but the intermediate ones are not, and need
to be downloaded for the certificate chain to be complete and for
<code>codesign</code> to work.</p>
<p>When you created your Developer ID certificate, you were likely prompted
between ‚ÄúG2 Sub-CA‚Äù and ‚ÄúPrevious Sub-CA‚Äù. At the time of writing, on the
<a href="https://www.apple.com/certificateauthority/">Apple PKI page</a>,
those are respectively <a href="https://www.apple.com/certificateauthority/DeveloperIDG2CA.cer">Developer ID - G2 (Expiring 09/17/2031 00:00:00 UTC)</a>
and <a href="https://www.apple.com/certificateauthority/DeveloperIDCA.cer">Developer ID - G1 (Expiring 02/01/2027 22:12:15 UTC)</a>.
So go ahead and download the appropriate one and install it to your
login keychain just like your developer certificate.</p>
<div class="note">
<p><strong>Note:</strong> if you don‚Äôt know what intermediate certificate you need, you
can see what <abbr title="Certificate authorith">CA</abbr> signed your
certificate like so:</p>
<pre><code class="hljs language-console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">openssl x509 -<span class="hljs-keyword">in</span> <span class="hljs-string">&quot;developerID_application.cer&quot;</span> -noout -issuer</span>
issuer=CN=Developer ID Certification Authority, OU=G2, O=Apple Inc., C=US
</code></pre>
<p>In this case, you can see my certificate was issued using the G2
intermediate certificate.</p>
</div>
<div class="note warn">
<p><strong>Warning:</strong> <a href="https://developer.apple.com/forums/thread/86161?answerId=422698022#422698022">leave the certificate trust settings</a>
to ‚ÄúUse System Defaults‚Äù and do not mark it as ‚ÄúAlways Trust‚Äù, both for
your developer certificate and the intermediate certificate.</p>
<p>If like me you were getting issues signing things and assumed marking as
‚ÄúAlways Trust‚Äù could help, beware, it does the opposite and prevents
<code>codesign</code> from working altogether for some reason, even after you fix
the actual cause of your signing issues. üòÖ</p>
<p>Whether you‚Äôre missing a certificate, or if you have the right
certificates but they‚Äôre marked as ‚ÄúAlways Trust‚Äù, you‚Äôll get that same
error:</p>
<pre><code class="hljs">Warning: unable to build chain to self-signed root for signer
</code></pre>
</div>
<h2 id="manually-sign-your-app" tabindex="-1"><a class="header-anchor" href="#manually-sign-your-app"><span>Manually sign your app</span></a></h2>
<p>You‚Äôre now in a place where you can manually sign your app:</p>
<pre><code class="hljs language-sh">codesign --sign <span class="hljs-string">&#x27;Developer ID Application: MyApp (ID)&#x27;</span> MyApp.app
</code></pre>
<p>To find the identify to pass to <code>--sign</code>:</p>
<pre><code class="hljs language-sh">security find-identity -v -p codesigning
</code></pre>
<p><code>-v</code> will show only valid identities. <code>-p</code> is for selecting a specific
policy, here we care about <code>codesigning</code>.</p>
<h2 id="signing-your-app-with-electron-forge" tabindex="-1"><a class="header-anchor" href="#signing-your-app-with-electron-forge"><span>Signing your app with Electron Forge</span></a></h2>
<p>Add <code>osxSign</code> to your <code>forge.config.js</code>:</p>
<pre><code class="hljs language-js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">packagerConfig</span>: {
    <span class="hljs-attr">osxSign</span>: {
      <span class="hljs-attr">identity</span>: <span class="hljs-string">&#x27;Developer ID Application: MyApp (ID)&#x27;</span>
    }
  }
}
</code></pre>
<p>If you only have one valid code signing identity configured on your Mac,
you can omit the <code>identity</code> parameter. You still need to pass an empty
object <code>osxSign: {}</code>.</p>
<h2 id="notarizing-your-app-with-electron-forge" tabindex="-1"><a class="header-anchor" href="#notarizing-your-app-with-electron-forge"><span>Notarizing your app with Electron Forge</span></a></h2>
<p>Add <code>osxNotarize</code> to your <code>forge.config.js</code>. There‚Äôs a few ways to
configure it <a href="https://www.electronforge.io/guides/code-signing/code-signing-macos#osxnotarize-options">documented here</a>.</p>
<p>The documentation is pretty clear and complete so I won‚Äôt bother
repeating anything here. üôÇ</p>
<h2 id="debugging-osxsign-and-osxnotarize" tabindex="-1"><a class="header-anchor" href="#debugging-osxsign-and-osxnotarize"><span>Debugging <code>osxSign</code> and <code>osxNotarize</code></span></a></h2>
<p>If you encounter issues where Electron is not properly signing or
notarizing your app, you can debug the signing and notarizing process
that way:</p>
<pre><code class="hljs language-sh">DEBUG=electron-osx-sign,electron-notarize* npx electron-forge package
</code></pre>
<p>This will output detailed logs that should help you identify the
culprit.</p>
<h2 id="conclusion" tabindex="-1"><a class="header-anchor" href="#conclusion"><span>Conclusion</span></a></h2>
<p>That should be all you need to have your app approved by Apple so that
you can share it with the world. üåé</p>
<p>Happy building! üöÄ</p>
<section class="post-footer">
  <h3>Want to leave a comment?</h3>
  <p>
    Join the discussion on <a href="https://x.com/valeriangalliat/status/1790906279852204042">X</a> or send me an <a href="mailto:val@codejam.info">email</a>! üíå<br>
    This post helped you? <a href="https://ko-fi.com/funkyval">Buy me a coffee</a>! üçª
  </p>
</section>
  </div>
  <footer>
    <div class="footer-inner">
      <figure>
        <a href="/val.html">
          <img alt="The author (Val) in front of a mountain" src="/img/profile.jpg">
        </a>
      </figure>
      <div class="footer-content">
        <p>
          Made with üß° by <a href="/val.html">Val</a>.
          Generated from a <abbr title="Pull requests welcome!"><a href="https://github.com/valeriangalliat/blog/tree/master/2024/05/sign-notarize-electron-app-macos.md">public repository</a></abbr>.
        </p>
        <ul class="social">
          <li>
            <a href="https://x.com/valeriangalliat">
              <svg width="16" height="16" viewBox="0 0 24 24">
                <title>X</title>
                <use href="/img/icons/x.svg#icon"></use>
              </svg>
            </a>
          </li>
          <li>
            <a href="https://github.com/valeriangalliat">
              <svg width="16" height="16" viewBox="0 0 24 24">
                <title>GitHub</title>
                <use href="/img/icons/github.svg#icon"></use>
              </svg>
            </a>
          </li>
          <li>
            <a href="https://www.instagram.com/funkyval_/">
              <svg width="16" height="16" viewBox="0 0 24 24">
                <title>Instagram</title>
                <use href="/img/icons/instagram.svg#icon"></use>
              </svg>
            </a>
          </li>
          <li>
            <a href="https://www.youtube.com/@FunkyVal">
              <svg width="16" height="16" viewBox="0 0 24 24">
                <title>YouTube</title>
                <use href="/img/icons/youtube.svg#icon"></use>
              </svg>
            </a>
          </li>
          <li>
            <a href="https://ko-fi.com/funkyval">
              <svg width="16" height="16" viewBox="0 0 24 24">
                <title>Buy me a coffee!</title>
                <use href="/img/icons/kofi.svg#icon"></use>
              </svg>
            </a>
          </li>
          <li>
            <a href="/feed.xml">
              <svg width="16" height="16" viewBox="0 0 24 24">
                <title>RSS</title>
                <use href="/img/icons/rss.svg#icon"></use>
              </svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </footer>
  <script src="/js/emojicon.js"></script>
  <script src="/js/main-20230317.js"></script>
</body>
</html>
